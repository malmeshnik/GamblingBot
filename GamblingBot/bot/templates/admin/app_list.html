<div id="custom-sidebar" class="module">
  <div class="sidebar-header">
    <a href="/admin/bot/bot/add" class="top-btn add-bot">+ –î–æ–¥–∞—Ç–∏ –±–æ—Ç–∞</a>
    <a href="/admin/bot/botstatistics" class="top-btn stats-bot">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å—ñ—Ö –±–æ—Ç—ñ–≤</a>
  </div>
  <ul class="app-list">
    {% for app in app_list %}
        <li class="app-{{ app.app_label }}">
            <table data-bot-id="{{ app.bot_id }}">
              <caption class="toggle-btn">
                <a href="/admin/bot/bot/{{ app.bot_id }}/change/"><b class="app_name">{{ app.name }}</b></a>
              </caption>
              <tbody class="model-list">
                {% for model in app.models %}
                <tr class="model-{{ model.name|lower }}">
                    <td>
                        <a href="{{ model.admin_url }}"
                           class="{% if model.name == cl.opts.verbose_name %}selected{% endif %}">
                           <b>{{ model.name }}</b>
                        </a>
                    </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
        </li>
        <br>
    {% endfor %}
  </ul>
</div>

<style>
#custom-sidebar ul,
#custom-sidebar li {
    list-style: none;
    margin: 0;
    padding: 0;
}

#custom-sidebar table {
  width: 100%;
}

.app_name {
  color: #fff;
}

/* ==== –í–µ—Ä—Ö–Ω—ñ –∫–Ω–æ–ø–∫–∏ ==== */
.sidebar-header {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.top-btn {
  flex: 1;
  padding: 8px 12px;
  font-size: 14px;
  font-weight: 600;
  text-align: center;
  text-decoration: none;
  border-radius: 6px;
  transition: all 0.2s ease-in-out;
  cursor: pointer;
}

.add-bot {
  background: linear-gradient(135deg, #4caf50, #2e7d32);
  color: #fff;
  border: 1px solid #2e7d32;
}

.add-bot:hover {
  background: linear-gradient(135deg, #66bb6a, #388e3c);
}

.stats-bot {
  background: linear-gradient(135deg, #5e7ce0, #3f51b5);
  color: #fff;
  border: 1px solid #3f51b5;
}

.stats-bot:hover {
  background: linear-gradient(135deg, #7986cb, #283593);
}
</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('#custom-sidebar table').forEach((table) => {
    const caption = table.querySelector('caption.toggle-btn');
    const tbody = table.querySelector('tbody.model-list');
    if (!caption || !tbody) return;

    const botId = table.dataset.botId || caption.textContent.trim();
    const storageKey = `bot-open-${botId}`;

    // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–∫–æ–Ω–∫—É-—Å—Ç—Ä—ñ–ª–∫—É, —è–∫—â–æ —ó—ó –Ω–µ–º–∞
    let icon = caption.querySelector('.toggle-icon');
    if (!icon) {
      icon = document.createElement('span');
      icon.className = 'toggle-icon';
      icon.setAttribute('aria-hidden', 'true');
      caption.prepend(icon);
    }

    // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω
    const isOpen = localStorage.getItem(storageKey) === 'true';
    tbody.style.display = isOpen ? 'table-row-group' : 'none';
    caption.classList.toggle('is-open', isOpen);

    // –ö–ª—ñ–∫ –ø–æ caption: —è–∫—â–æ –∫–ª—ñ–∫–Ω—É–ª–∏ –Ω–∞ <a> ‚Äî –¥–∞—î–º–æ –ø–µ—Ä–µ–π—Ç–∏; —ñ–Ω–∞–∫—à–µ ‚Äî –ª–∏—à–µ toggle
    caption.addEventListener('click', (e) => {
      if (e.target && e.target.closest('a')) return; // –¥–æ–∑–≤–æ–ª—è—î–º–æ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—é
      e.preventDefault();

      const currentlyOpen = tbody.style.display !== 'none';
      const nextOpen = !currentlyOpen;

      tbody.style.display = nextOpen ? 'table-row-group' : 'none';
      caption.classList.toggle('is-open', nextOpen);
      localStorage.setItem(storageKey, String(nextOpen));
    });
  });
});
</script>